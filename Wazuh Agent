Wazuh Agent Deployment Guide
Table of Contents
Introduction
System Requirements
Installation of Wazuh Agent
Configuration of Wazuh Agent
Installation of Sysmon
Configuration of Sysmon
Installation of Packetbeat
Configuration of Packetbeat
Conclusion
Introduction
Wazuh is a powerful open-source security information and event management (SIEM) solution that provides real-time threat detection,
integrity monitoring, incident response, and compliance management. This guide details the installation and configuration of the Wazuh
agent on a target system, along with Sysmon for Windows logging and Packetbeat for network monitoring.

System Requirements
Operating System: Windows, Linux, or macOS
Wazuh Manager: A running Wazuh manager instance to receive and process data.
Internet Connection: Required for downloading packages and updates.
Installation of Wazuh Agent
For Windows
Download the Wazuh Agent installer from the Wazuh downloads page.
Run the installer and follow the prompts.
Choose the installation directory and complete the installation.
For Linux
Add the Wazuh repository:

wget -qO - https://packages.wazuh.com/key/GPG-KEY-WAZUH | sudo apt-key add -
echo "deb http://packages.wazuh.com/4.x/apt/ $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/wazuh.list
Update the package list and install the Wazuh agent:

sudo apt-get update
sudo apt-get install wazuh-agent
Configuration of Wazuh Agent
Edit the Wazuh agent configuration file:

For Windows: C:\Program Files (x86)\Wazuh Agent\ossec.conf
For Linux: /var/ossec/etc/ossec.conf
Update the configuration to point to your Wazuh Manager:

<manager>
    <name>wazuh-manager</name>
    <address>YOUR_WAZUH_MANAGER_IP</address>
</manager>
Restart the Wazuh agent:

For Windows: Use the Services management console to restart the Wazuh Agent service.
For Linux:

sudo systemctl restart wazuh-agent
Installation of Sysmon
Sysmon (System Monitor) is part of the Sysinternals Suite and can be used to log system activity to the Windows event log.

Download Sysmon from the Microsoft Sysinternals page.
Extract the files and open a command prompt with administrative privileges.
Install Sysmon using the following command:

sysmon -accepteula -i sysmon-config.xml
Configuration of Sysmon
Create a configuration file sysmon-config.xml to define what events to capture. An example configuration is:

<Sysmon schemaversion="4.50">
    <EventFiltering>
        <ProcessCreate onmatch="include">
            <CommandLine onmatch="include">powershell.exe</CommandLine>
        </ProcessCreate>
        <DriverLoad onmatch="include"/>
        <NetworkConnect onmatch="include"/>
        <ImageLoad onmatch="include"/>
    </EventFiltering>
</Sysmon>
Update Sysmon with the new configuration:

sysmon -c sysmon-config.xml
Installation of Packetbeat
Packetbeat is a lightweight network packet analyzer that monitors your network traffic in real-time.

For Debian/Ubuntu
Install the Elastic APT repository:

wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -
echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-7.x.list
Install Packetbeat:

sudo apt-get update
sudo apt-get install packetbeat
For Windows
Download Packetbeat from the Elastic downloads page.
Extract the files and run the installation.
Configuration of Packetbeat
Edit the Packetbeat configuration file:

For Windows: C:\Program Files\Packetbeat\packetbeat.yml
For Linux: /etc/packetbeat/packetbeat.yml
Configure the network interfaces and the output to Elasticsearch:

packetbeat.interfaces:
  # List of devices to sniff
  device: any

output.elasticsearch:
hosts: ["YOUR_ELASTICSEARCH_HOST:9200"]
Start Packetbeat:

For Windows: 
Use the command prompt to navigate to the Packetbeat directory and run packetbeat.exe -e.
For Linux:
sudo systemctl start packetbeat
Conclusion
You have now successfully deployed the Wazuh agent along with Sysmon and Packetbeat. This configuration provides comprehensive
monitoring of system events and network traffic, enhancing your security posture. Make sure to regularly check the logs and alerts
generated by Wazuh for any potential threats.
